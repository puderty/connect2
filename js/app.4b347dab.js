(function(){var e={7996:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_METHOD_FETCHMSG=t.CONNECT_METHOD_RECEIVE=t.CONNECT_METHOD_UNSUB=t.CONNECT_METHOD_SUB=t.CONNECT_METHOD_PUBLISH=t.CONNECT_METHOD_LOGIN=t.CONNECT_METHOD_PUSH=void 0,t.CONNECT_METHOD_PUSH="push",t.CONNECT_METHOD_LOGIN="login",t.CONNECT_METHOD_PUBLISH="publish",t.CONNECT_METHOD_SUB="subscribe",t.CONNECT_METHOD_UNSUB="unsubscribe",t.CONNECT_METHOD_RECEIVE="receive",t.CONNECT_METHOD_FETCHMSG="fetchMessages"},3750:function(e,t,n){"use strict";n(4603),n(7566),n(8721);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXWalletConnector=void 0;const c=n(3193),a=n(7900),l=n(1930),d=n(2384),u=i(n(4529)),f=(0,l.resolveWebSocketImplementation)();class h{constructor(e){if(this.events=new d.EventEmitter,this.state=c.ConnectorState.InitState,!(0,l.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e}get connecting(){return this.state==c.ConnectorState.Connecting}onPayload(e){if("undefined"!==typeof e.data){if(u.logDebug("get received data"),u.logDebug(e),"string"===typeof e.data){let t=e.data;if("pong"===t)return void u.logDebug(`CONNECT: receive pong ${Date.now().toString()}`)}this.events.emit("payload",e.data)}}onClose(e){this.socket=void 0,this.events.emit("close",e)}onError(e,t){const n={id:e,msg:t.toString()};this.events.emit("payload",n)}onopen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.state=c.ConnectorState.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){this.socket?this.socket.readyState===WebSocket.OPEN?(u.logDebug(`send ping heart beat: ${Date.now().toString()}`),this.socket.send("ping"),setTimeout(this.heartbeat.bind(this),15e3)):u.logDebug("socket not ready"):u.logDebug("socket not exist")}registOpen(e=this.url){if(!(0,l.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);if(this.connecting){const e=this.events.getMaxListeners();return(this.events.listenerCount("open")>=e||this.events.listenerCount("fail")>=e)&&this.events.setMaxListeners(e+1),new Promise(((e,t)=>{this.events.once("fail",(e=>{this.events.getMaxListeners()>c.EVENT_EMITTER_MAX_LISTENERS&&this.events.setMaxListeners(c.EVENT_EMITTER_MAX_LISTENERS),t(e)})),this.events.once("open",(()=>{if(this.events.getMaxListeners()>c.EVENT_EMITTER_MAX_LISTENERS&&this.events.setMaxListeners(c.EVENT_EMITTER_MAX_LISTENERS),"undefined"==typeof this.socket)return t(new Error("Connect lost"));e(this.socket)}))}))}this.url=e,this.state=c.ConnectorState.Connecting;new URLSearchParams(e).get("origin");const t={rejectUnauthorized:!1};return new Promise(((n,o)=>{const r=new f(e,[],t);(0,l.hasBuiltInWebSocket)()?r.onerror=e=>{const t=e;o(this.emitError(t.error))}:r.on("error",(e=>{o(this.emitError(e))})),r.onopen=()=>{u.logDebug("socket opened"),this.onopen(r),this.heartbeat(),n(r)}}))}onVisibleChanged(){"visible"===document.visibilityState&&(u.logDebug(`get changed ${this.state}, ${this.socket}`),this.state==c.ConnectorState.Connected&&"undefined"===typeof this.socket&&(u.logDebug("CONNECTION need reopen"),this.registOpen()))}connect(){return s(this,void 0,void 0,(function*(){yield this.registOpen(this.url),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}))}disconnect(){return s(this,void 0,void 0,(function*(){return this.state=c.ConnectorState.Disconnected,new Promise(((e,t)=>{"undefined"!==typeof this.socket?(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close()):e()}))}))}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,n,o){this.events.on("payload",(r=>{var i;u.logDebug(`<<< get payload ${r}`),u.logDebug(r);let s=(0,a.safeJsonParse)(r);if(s.params&&s.params.data){let c=null===(i=s.params.data)||void 0===i?void 0:i.message;if(c)try{let o=t(c);n(e,o)}catch(r){u.logDebug(`CONNECT: decrypt failed: ${r}`),o(e,r.message)}}})),this.events.on("fail",(t=>{t?(u.logDebug(`CONNECT failed: ${t}`),o(e,t.message)):o(e,"Unkonow error")}))}addPackageParse(e){this.events.on("payload",(t=>s(this,void 0,void 0,(function*(){u.logDebug(`<<<< received e:${t}`);let n=(0,a.safeJsonParse)(t);yield e(n)}))))}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return s(this,void 0,void 0,(function*(){"undefined"===typeof this.socket&&(u.logDebug(`>>> send payload undefined ${t}`),yield e());try{u.logDebug(`>>> send payload ${(0,a.safeJsonStringify)(t)}`),this.socket&&this.socket.send((0,a.safeJsonStringify)(t))}catch(n){this.onError(t.id,n)}}))}getMsgPayloadFromHistory(e){return s(this,void 0,void 0,(function*(){if("undefined"===typeof e)return;let t={params:{data:e}},n=(0,a.safeJsonStringify)(e);u.logDebug("get received data from history"),u.logDebug(n),n=(0,a.safeJsonStringify)(t),this.events.emit("payload",n)}))}onOpen(e){this.events.on("open",(()=>s(this,void 0,void 0,(function*(){u.logDebug(">>> ws opened: "),yield e()}))))}}t.OKXWalletConnector=h},4555:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionManager=void 0;const c=n(3750),a=n(7996),l=n(104),d=n(4752),u=n(3193),f=n(2384),h=n(3765),_=n(1930),g=n(3318),O=n(3597),E=n(7900),v=i(n(4529));class p{constructor(){this.events=new f.EventEmitter,this.connectStorage=new h.Storage(l.OKXCONNECTOR_CACHE_KEY),this.crypto=new g.SessionCrypto,this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new c.OKXWalletConnector(u.OKXCONNECTOR_WS_URL),this.packageId=Date.now(),this.sendEnable=!1,this.connectedWalletPK="",this.currentTopic="",v.logDebug(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){this.packageId=Date.now()}saveCryptoKeyPair(e){let t=(0,E.safeJsonStringify)(e);this.connectStorage.saveContent(t,l.OKXCONNECTOR_CRYPTO_KEY)}getCachedCryptoKeyPair(){const e=this.connectStorage.getItem(l.OKXCONNECTOR_CRYPTO_KEY),t=null===e||void 0===e?void 0:e.content;if("string"==typeof t){v.logDebug("get cached crypto key:"),v.logDebug(t);let e=(0,E.safeJsonParse)(t);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:(0,_.toHexString)(e.publicKey),secretKey:(0,_.toHexString)(e.secretKey)};v.logDebug("save jwt kp");let n=(0,E.safeJsonStringify)(t);v.logDebug(n),this.connectStorage.saveContent(n,l.OKXCONNECTOR_JWT_KEY)}getCachedJWTKeyPair(){const e=this.connectStorage.getItem(l.OKXCONNECTOR_JWT_KEY),t=null===e||void 0===e?void 0:e.content;if("string"==typeof t){v.logDebug("get cached jwt kp:"),v.logDebug(t);let e=(0,E.safeJsonParse)(t);v.logDebug("save jwt kp"),v.logDebug(e);var n={publicKey:(0,_.hexToByteArray)(e.publicKey),secretKey:(0,_.hexToByteArray)(e.secretKey)};return n}return(0,O.generateKeyPair)()}isWalletPKReady(){return v.logDebug(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return s(this,void 0,void 0,(function*(){return yield(0,O.signJWT)(e,d.OKXCONNECTOR_JWT_SIDE,d.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)}))}parsePackage(e){return s(this,arguments,void 0,(function*(e,t=!1){var n;if(this.events.emit(e.id,e),!t){yield this.sendACK(e.id,!0);let t=null===(n=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE))||void 0===n?void 0:n.content;t&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e.id,t))}}))}restoreConnect(e){return s(this,void 0,void 0,(function*(){if(v.logDebug(`connectionManager  restoreConenct   ${e}`),"string"!==typeof e||0===e.length)throw new Error("CONNECTION: invalid topic");v.logDebug("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,l.OKXCONNECTOR_TOKEN_CACHE),v.logDebug("connectionManager  restoreConenct   conect"),yield this.connect(!0)}))}getConnectInfo(){var e=(0,_.generateTopic)();v.logDebug(`generate topic token: ${e}`),this.currentTopic=e;const t={channelId:e,clientId:this.crypto.stringifyKeypair().publicKey};return t}connect(){return s(this,arguments,void 0,(function*(e=!1){let t=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE);var n=this.currentTopic;if(v.logDebug(`generate topic token: ${n}`),e){"undefined"!==typeof t&&null!==t&&(v.logDebug(`read last connect id: ${t}`),n=t.content);var o=this.connectStorage.getItem(l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE);o&&(this.connectedWalletPK=o.content);const e=this.getCachedCryptoKeyPair();this.crypto=new g.SessionCrypto(e)}v.logDebug(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()),this.connectStorage.saveContent(n,l.OKXCONNECTOR_TOKEN_CACHE);var r=yield this.makeJWT(n);v.logDebug(`generate jwt token: ${r}`),this.connectStorage.saveContent(r,"jwt"),this.connector.onOpen((()=>s(this,void 0,void 0,(function*(){v.logDebug("1. connector on open"),this.events.once(this.packageId.toString(),(()=>s(this,void 0,void 0,(function*(){this.refreshPackageId(),this.events.once(this.packageId.toString(),(()=>s(this,void 0,void 0,(function*(){this.refreshPackageId(),v.logDebug(`4. subscribe callback then send fetch: ${this.packageId}`),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),n)})))),v.logDebug(`3. login callback then send subscribe: ${this.packageId}`),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_SUB,params:{topic:n}})})))),v.logDebug("2. login called"),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_LOGIN,params:{token:r}}),this.connector.addPackageParse((e=>{var t;if(v.logDebug("connect: parse package"),v.logDebug(e),!("params"in e)||!("data"in e["params"]))return v.logDebug("connect: TEST: received msg"),void this.parsePackage(e,!0);let n=null===(t=e.params.data)||void 0===t?void 0:t.message;if("undefined"!==typeof n){n=n.replace(/'/g,'"');let e=(0,E.safeJsonParse)(n);"string"!==typeof e&&"clientId"in e&&e.clientId&&e.clientId.length>0&&0==this.connectedWalletPK.length&&(this.connectedWalletPK=e.clientId,v.logDebug(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE))}this.parsePackage(e,e.method===a.CONNECT_METHOD_RECEIVE)}))})))),yield this.connector.connect();const i={channelId:n,clientId:this.crypto.stringifyKeypair().publicKey};return i}))}disconnect(){return s(this,arguments,void 0,(function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(l.OKXCONNECTOR_TOKEN_CACHE),e||(this.connectStorage.clearCache(l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.connectedWalletPK="")}))}addListener(e,t,n){this.connector.addListener((0,E.safeJsonStringify)(e),(e=>{if(e=e.replace(/'/g,'"'),v.logDebug(`addListener ===> ${e}`),"undefined"!==typeof e){var t=(0,E.safeJsonParse)(e),n=t.message;t.clientId&&t.clientId.length>0&&0==this.connectedWalletPK.length&&(this.connectedWalletPK=t.clientId,this.connectStorage.saveContent(this.connectedWalletPK,l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),v.logDebug(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`));var o=this.crypto.decrypt(n,this.connectedWalletPK);return v.logDebug(`addListener ===> ${o}`),o}}),t,n)}send(e){return s(this,void 0,void 0,(function*(){if(v.logDebug(`messagesend =====> ${e}`),!this.isWalletPKReady())throw new Error("connection not finish");let t=this.crypto.encrypt(e,this.connectedWalletPK),n=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE);this.refreshPackageId();const o={id:this.packageId.toString(),method:a.CONNECT_METHOD_PUBLISH,jsonrpc:u.CONNECT_JSONRPC_VER,params:{message:{messageId:Date.now().toString(),topic:null===n||void 0===n?void 0:n.content,message:t,ttl:u.OKXCONNECTOR_MESSAGE_TTL}}};return yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o),this.packageId}))}sendACK(e,t){return s(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,error:{code:n.code,message:n.message}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return s(this,void 0,void 0,(function*(){const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}sendFetchAndConsumeMessages(e,t){return s(this,void 0,void 0,(function*(){this.events.once(e,(e=>s(this,void 0,void 0,(function*(){var n,o;if(e.result){var r=e.result.hasMore,i=e.result.data;if(i)for(let e=0;e<i.length;e++){let n=i[e],o=n.messageId,r=n.topic;r==t&&(yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),o,t))}r&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else v.logDebug(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(o=e.error)||void 0===o?void 0:o.message}`)})))),v.logDebug("5. send fetch more");const n={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){v.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),n)}))}getCryptoInfo(){var e;const t=this.crypto.stringifyKeypair(),n=this.connectStorage.getItem("jwt");return{kp:t,topic:null===(e=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE))||void 0===e?void 0:e.content,jwt:null===n||void 0===n?void 0:n.content}}cleanCache(){return s(this,void 0,void 0,(function*(){this.connectStorage.clearCache()}))}}t.ConnectionManager=p},3193:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorState=t.CONNECT_JSONRPC_VER=t.OKXCONNECTOR_MESSAGE_TTL=t.OKXCONNECTOR_WS_URL=t.EVENT_EMITTER_MAX_LISTENERS=void 0,t.EVENT_EMITTER_MAX_LISTENERS=10,t.OKXCONNECTOR_WS_URL="wss://test-walletreplay.okg.com/ws/v1/wallet-connect-relay",t.OKXCONNECTOR_MESSAGE_TTL=3e5,t.CONNECT_JSONRPC_VER="2.0",t.ConnectorState={InitState:0,Connecting:1,Connected:2,Disconnected:3}},7620:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const r=n(611),i=n(7900),s=n(4529);class c{constructor(e){this.pendingRequests=new Map,this.disconnectListener=[],this.connectionManager=e,this.connectionManager.addListener("ton_sdk_response",((e,t)=>{var n=(0,i.safeJsonParse)(t);this.handleResponse(e,n)}),(function(){}))}addDisconnectListener(e){this.disconnectListener.push(e)}disconnect(){(0,s.logDebug)("Engine ==>> disconnect"),this.pendingRequests.clear()}getRequestId(){return o(this,void 0,void 0,(function*(){const e=Date.now().toString();return(0,s.logDebug)("Engine ==>> getRequestId ==>",e),e}))}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,n){return o(this,void 0,void 0,(function*(){const o=yield this.getRequestId();(0,r.callForSuccess)((()=>this.connectionManager.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:o})))),n),this.bindRequestForPromise(o,t)}))}handleResponse(e,t){if((0,s.logDebug)(`Engine ==>> handleResponse_1  ======>response: ${(0,i.safeJsonStringify)(t)}`),"requestId"in t){(0,s.logDebug)("Engine ==>> handleResponse_2  ===> in response");let e=t.requestId;const n=this.pendingRequests.get(e);n?((0,s.logDebug)("Engine ==>> handleResponse_3  ===> find resolve:",n),n(t),this.pendingRequests.delete(e)):((0,s.logDebug)("Engine ==>> handleResponse_3  ===> not find resolve:"),"disconnect"===t.method&&(this.disconnectListener.forEach((e=>e())),this.disconnectListener=[],this.disconnect()))}}}t.Engine=c},3597:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MULTICODEC_ED25519_LENGTH=t.MULTICODEC_ED25519_HEADER=t.MULTICODEC_ED25519_BASE=t.MULTICODEC_ED25519_ENCODING=t.DID_METHOD=t.DID_PREFIX=t.DID_DELIMITER=t.KEY_PAIR_SEED_LENGTH=t.DATA_ENCODING=t.JSON_ENCODING=t.JWT_ENCODING=t.JWT_DELIMITER=t.JWT_IRIDIUM_TYP=t.JWT_IRIDIUM_ALG=t.JWTHeaderType=void 0,t.generateKeyPair=g,t.decodeJSON=O,t.encodeJSON=E,t.encodeIss=v,t.decodeIss=p,t.encodeSig=C,t.decodeSig=N,t.encodeData=T,t.decodeData=y,t.encodeJWT=b,t.decodeJWT=R,t.signJWT=S,t.verifyJWT=D;const a=i(n(7409)),l=n(5709),d=n(5454),u=n(7900),f=n(1930),h=c(n(2132)),_=i(n(4529));function g(){return h.default.sign.keyPair()}function O(e){return(0,u.safeJsonParse)((0,l.toString)((0,d.fromString)(e,t.JWT_ENCODING),t.JSON_ENCODING))}function E(e){return(0,l.toString)((0,d.fromString)((0,u.safeJsonStringify)(e),t.JSON_ENCODING),t.JWT_ENCODING)}function v(e){_.logDebug(`publicKey: ${(0,f.toHexString)(e)}`);var n=(0,l.toString)(e,t.MULTICODEC_ED25519_ENCODING);return[t.DID_PREFIX,t.DID_METHOD,n].join(t.DID_DELIMITER)}function p(e){const[n,o,r]=e.split(t.DID_DELIMITER);if(n!==t.DID_PREFIX||o!==t.DID_METHOD)throw new Error('Issuer must be a DID with method "key"');const i=(0,d.fromString)(r,t.MULTICODEC_ED25519_ENCODING);if(i.length!==t.MULTICODEC_ED25519_LENGTH)throw new Error("Issuer must be a public key with length 32 bytes");return i}function C(e){return(0,l.toString)(e,t.JWT_ENCODING)}function N(e){return(0,d.fromString)(e,t.JWT_ENCODING)}function T(e){return(0,d.fromString)([E(e.header),E(e.payload)].join(t.JWT_DELIMITER),t.DATA_ENCODING)}function y(e){const n=(0,l.toString)(e,t.DATA_ENCODING).split(t.JWT_DELIMITER),o=O(n[0]),r=O(n[1]);return{header:o,payload:r}}function b(e){return[E(e.header),E(e.payload),C(e.signature)].join(t.JWT_DELIMITER)}function R(e){const n=e.split(t.JWT_DELIMITER),o=O(n[0]),r=O(n[1]),i=N(n[2]),s=(0,d.fromString)(n.slice(0,2).join(t.JWT_DELIMITER),t.DATA_ENCODING);return{header:o,payload:r,signature:i,data:s}}function S(e,n,o,r){return s(this,arguments,void 0,(function*(e,n,o,r,i=Math.floor(Date.now())){const s={alg:t.JWT_IRIDIUM_ALG,typ:t.JWT_IRIDIUM_TYP},c=v(r.publicKey),a=i+o,l="authenticate user",d={iss:c,sub:e,aud:n,act:l,iat:i,exp:a},u=T({header:s,payload:d});_.logDebug(`get sec kp: ${r.secretKey} {${r.secretKey.length}}`);const f=h.default.sign.detached(u,r.secretKey);return b({header:s,payload:d,signature:f})}))}function D(e){return s(this,void 0,void 0,(function*(){const{header:n,payload:o,data:r,signature:i}=R(e);if(n.alg!==t.JWT_IRIDIUM_ALG||n.typ!==t.JWT_IRIDIUM_TYP)throw new Error("JWT must use EdDSA algorithm");const s=p(o.iss);return a.verify(s,r,i)}))}t.JWTHeaderType="dapp",t.JWT_IRIDIUM_ALG="EdDSA",t.JWT_IRIDIUM_TYP="JWT",t.JWT_DELIMITER=".",t.JWT_ENCODING="base64url",t.JSON_ENCODING="utf8",t.DATA_ENCODING="utf8",t.KEY_PAIR_SEED_LENGTH=32,t.DID_DELIMITER=":",t.DID_PREFIX="did",t.DID_METHOD="key",t.MULTICODEC_ED25519_ENCODING="base58btc",t.MULTICODEC_ED25519_BASE="z",t.MULTICODEC_ED25519_HEADER="K36",t.MULTICODEC_ED25519_LENGTH=32},4752:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_JWT_TTL=t.OKXCONNECTOR_JWT_SIDE=void 0,t.OKXCONNECTOR_JWT_SIDE="wallet",t.OKXCONNECTOR_JWT_TTL=864e5},3765:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;const s=n(1930),c=n(7900),a=i(n(4529));class l{constructor(e){const t=(0,s.resolveLocalStorage)();this.subKey=e,a.logDebug("--------get current local storage --------"),a.logDebug(t);const n=t.getItem(l.cacheKey+e);if("undefined"===typeof n||null===n)return a.logDebug("with no cache"),void(this.cache={});if(a.logDebug(n),(null===n||void 0===n?void 0:n.length)>0){var o=(0,c.safeJsonParse)(n);this.cache=o}a.logDebug(`get cache obj: ${this.cache}`),"undefined"!==typeof this.cache&&null!=this.cache||(this.cache={})}saveContent(e,t,n="-"){let o={id:n,timestamp:Date.now().toString(),content:e};this.saveItem(o,t)}saveItem(e,t){let n=l.cacheKey+this.subKey;const o=(0,s.resolveLocalStorage)();a.logDebug(this.cache),a.logDebug(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let r=(0,c.safeJsonStringify)(this.cache);a.logDebug(`STORAGE: ${t} @ ${this.cache}`),o.setItem(n,r)}getItem(e){return a.logDebug(`STORAGE: ${e} @ ${this.cache}`),this.cache[e]}clearCache(e=void 0){if(void 0===e){this.cache={};let e=l.cacheKey+this.subKey;localStorage.setItem(e,"")}else{let t=l.cacheKey+this.subKey;const n=(0,s.resolveLocalStorage)();a.logDebug(this.cache),this.cache[e]=null;let o=(0,c.safeJsonStringify)(this.cache);a.logDebug(`STORAGE: clean key ${e} @ ${this.cache}`),n.setItem(t,o)}}}t.Storage=l,l.cacheKey="OKXStorageKey"},104:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE=t.OKXCONNECTOR_TOKEN_CACHE=t.OKXCONNECTOR_JWT_KEY=t.OKXCONNECTOR_CRYPTO_KEY=t.OKXCONNECTOR_CACHE_KEY=void 0,t.OKXCONNECTOR_CACHE_KEY="test_key",t.OKXCONNECTOR_CRYPTO_KEY="test_crypto_key",t.OKXCONNECTOR_JWT_KEY="test_jwt_key",t.OKXCONNECTOR_TOKEN_CACHE="test_token",t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE="test_sender_publicKey"},3318:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionCrypto=void 0;const r=o(n(2132)),i=n(1930);class s{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair()}createKeypair(){return r.default.box.keyPair()}createKeypairFromString(e){return{publicKey:(0,i.hexToByteArray)(e.publicKey),secretKey:(0,i.hexToByteArray)(e.secretKey)}}createNonce(){return r.default.randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){const n=(new TextEncoder).encode(e),o=this.createNonce(),s=r.default.box(n,o,(0,i.hexToByteArray)(t),this.keyPair.secretKey);var c=(0,i.toHexString)((0,i.concatUint8Arrays)(o,s)),a=(new TextEncoder).encode(c);return(0,i.base64encode)(a,!1)}decrypt(e,t){let n=(0,i.base64decode)(e,!0),o=n.toUint8Array();const[s,c]=(0,i.splitToUint8Arrays)(o,this.nonceLength),a=r.default.box.open(c,s,(0,i.hexToByteArray)(t),this.keyPair.secretKey);if(!a)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${this.keyPair.publicKey.toString()} \n keypair secretkey: ${this.keyPair.secretKey.toString()}`);return(new TextDecoder).decode(a)}stringifyKeypair(){return{publicKey:(0,i.toHexString)(this.keyPair.publicKey),secretKey:(0,i.toHexString)(this.keyPair.secretKey)}}}t.SessionCrypto=s},823:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletNotConnectedError=t.WalletNotSupportFeatureError=t.WalletAlreadyConnectedError=t.UserRejectsError=t.UnknownError=t.OkxConnectError=void 0;var o=n(1394);Object.defineProperty(t,"OkxConnectError",{enumerable:!0,get:function(){return o.OkxConnectError}});var r=n(2833);Object.defineProperty(t,"UnknownError",{enumerable:!0,get:function(){return r.UnknownError}});var i=n(8954);Object.defineProperty(t,"UserRejectsError",{enumerable:!0,get:function(){return i.UserRejectsError}});var s=n(4213);Object.defineProperty(t,"WalletAlreadyConnectedError",{enumerable:!0,get:function(){return s.WalletAlreadyConnectedError}});var c=n(9171);Object.defineProperty(t,"WalletNotSupportFeatureError",{enumerable:!0,get:function(){return c.WalletNotSupportFeatureError}});var a=n(1800);Object.defineProperty(t,"WalletNotConnectedError",{enumerable:!0,get:function(){return a.WalletNotConnectedError}})},1394:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OkxConnectError=void 0;class n extends Error{get info(){return""}constructor(e){super(e),this.message=`${n.prefix} ${this.constructor.name}${this.info?": "+this.info:""}${e?"\n"+e:""}`,Object.setPrototypeOf(this,n.prototype)}}t.OkxConnectError=n,n.prefix="[OKX_CONNECT_SDK_ERROR]"},2833:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownError=void 0;const o=n(1394);class r extends o.OkxConnectError{}t.UnknownError=r},8954:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRejectsError=void 0;const o=n(1394);class r extends o.OkxConnectError{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}get info(){return"User rejects the action in the wallet."}}t.UserRejectsError=r},4213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletAlreadyConnectedError=void 0;const o=n(1394);class r extends o.OkxConnectError{get info(){return"Wallet connection called but wallet already connected. To avoid the error, disconnect the wallet before doing a new connection."}}t.WalletAlreadyConnectedError=r},1800:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletNotConnectedError=void 0;const o=n(1394);class r extends o.OkxConnectError{get info(){return"Send transaction or other protocol methods called while wallet is not connected."}}t.WalletNotConnectedError=r},9171:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletNotSupportFeatureError=void 0;const o=n(1394);class r extends o.OkxConnectError{get info(){return"Wallet doesn't support requested feature method."}}t.WalletNotSupportFeatureError=r},1082:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(823),t)},5998:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultStorage=void 0;const r=n(6556);class i{constructor(){this.localStorage=(0,r.tryGetLocalStorage)()}getItem(e){return o(this,void 0,void 0,(function*(){return this.localStorage.getItem(e)}))}removeItem(e){return o(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}setItem(e,t){return o(this,void 0,void 0,(function*(){this.localStorage.setItem(e,t)}))}}t.DefaultStorage=i},6274:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryStorage=void 0;class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}constructor(){this.storage={}}get length(){return Object.keys(this.storage).length}clear(){this.storage={}}getItem(e){var t;return null!==(t=this.storage[e])&&void 0!==t?t:null}key(e){var t;const n=Object.keys(this.storage);return e<0||e>=n.length?null:null!==(t=n[e])&&void 0!==t?t:null}removeItem(e){delete this.storage[e]}setItem(e,t){this.storage[e]=t}}t.InMemoryStorage=n},611:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};function o(e,t){return n(this,void 0,void 0,(function*(){var n,o;const i=null!==(n=null===t||void 0===t?void 0:t.attempts)&&void 0!==n?n:3,s=null!==(o=null===t||void 0===t?void 0:t.delayMs)&&void 0!==o?o:800;if("function"!==typeof e)throw new Error("Expected a function, got "+typeof e);let c,a=0;while(a<i)try{return yield e()}catch(l){c=l,a++,a<i&&(yield r(s))}throw c}))}function r(e,t){return n(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{var r,i;if(null===(r=null===t||void 0===t?void 0:t.signal)||void 0===r?void 0:r.aborted)return void o(new Error("Delay aborted"));const s=setTimeout((()=>n()),e);null===(i=null===t||void 0===t?void 0:t.signal)||void 0===i||i.addEventListener("abort",(()=>{clearTimeout(s),o(new Error("Delay aborted"))}))}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.callForSuccess=o,t.delay=r},9165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateOKXLink=r;const o=n(8538);function r(e){let t=`{ "protocolVer":1, "channelId":"${e.channelId}", "clientId":"${e.clientId}", "dAppInfo":{ "url":"url", "name":"testApp", "iconUrl":"url" }, "requestId":"${e.requestId}", "requests":[ { "name":"ton_addr" }, { "name":"ton_proof", "payload":"${e.testPayload}"}], "redirect":"${e.redirect}" }`,n=o.Buffer.from(t).toString("base64");return`https://www.okx.com/download?deeplink=okx%3A%2F%2Fweb3%2Fwallet%2Fconnect%3Fparam%3D${n}`}},4529:function(e,t){"use strict";function n(...e){try{console.debug("[OKX_CONNECT_SDK]",...e)}catch(t){}}function o(...e){try{console.error("[OKX_CONNECT_SDK]",...e)}catch(t){}}function r(...e){try{console.warn("[OKX_CONNECT_SDK]",...e)}catch(t){}}Object.defineProperty(t,"__esModule",{value:!0}),t.logDebug=n,t.logError=o,t.logWarning=r},7900:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=s,t.safeJsonStringify=c;const o=n(4529),r=e=>JSON.stringify(e,((e,t)=>"bigint"===typeof t?t.toString()+"n":t)),i=e=>{const t=/(?<!")(?<=:)\b(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,n=e.replace(t,(e=>`"${e}n"`));return JSON.parse(n,((e,t)=>{const n="string"===typeof t&&t.match(/^\d+n$/);return n?BigInt(t.substring(0,t.length-1)):t}))};function s(e){if("string"!==typeof e)throw(0,o.logDebug)(e),new Error("Cannot safe json parse value of type "+typeof e);try{return i(e)}catch(t){return console.error("safeJsonParse error:",t),e}}function c(e){return"string"===typeof e?e:r(e)||""}},1110:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeUrlLastSlash=r,t.addPathToUrl=i,t.getUniversalLink=s,t.openOKXDeeplinkWithFallback=c;const o=n(9069);function r(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function i(e,t){return r(e)+"/"+t}function s(e){const t=encodeURIComponent(e);return`${o.standardUniversalLink}?deeplink=${t}`}function c(e){s(e),/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;window.location.href=e}},1930:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RANDOM_LENGTH=t.isBrowser=t.resolveLocalStorage=t.hasLocalStorage=t.hasBuiltInWebSocket=t.resolveWebSocketImplementation=void 0,t.hexToByteArray=h,t.toHexString=_,t.concatUint8Arrays=g,t.splitToUint8Arrays=O,t.base64encode=p,t.base64decode=C,t.checkWSUrl=N,t.hashKey=D,t.generateRandomBytes32=I,t.generateTopic=P,t.generateDeepLink=m;const r=o(n(2132)),i=o(n(3683)),s=n(5454),c=n(5709),a=n(7557),l=n(7900),d=n(9165),u=n(4529),f="base16";function h(e){if(e.length%2!==0)throw new Error(`Cannot convert ${e} to bytesArray`);const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.slice(n,n+2),16);return t}function _(e){let t="";return e.forEach((e=>{t+=("0"+(255&e).toString(16)).slice(-2)})),t}function g(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function O(e,t){if(t>=e.length)throw new Error("Index is out of buffer");const n=e.slice(0,t),o=e.slice(t);return[n,o]}function E(e,t){const n=i.default.encodeBase64(e);return t?encodeURIComponent(n):n}function v(e,t){return t&&(e=decodeURIComponent(e)),i.default.decodeBase64(e)}function p(e,t){let n;return e instanceof Uint8Array?n=e:("string"!==typeof e&&(e=(0,l.safeJsonStringify)(e)),n=i.default.decodeUTF8(e)),E(n,t)}function C(e,t){const n=v(e,t);return{toString(){return i.default.encodeUTF8(n)},toObject(){try{return(0,l.safeJsonParse)(i.default.encodeUTF8(n))}catch(e){return null}},toUint8Array(){return n}}}function N(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!t||!t.length)return!1;let n=t[0];return new RegExp("^wss?:").test(n)}const T=()=>"undefined"!==typeof WebSocket?WebSocket:"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket?n.g.WebSocket:"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket?window.WebSocket:"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket?self.WebSocket:n(146);t.resolveWebSocketImplementation=T;const y=()=>"undefined"!==typeof WebSocket||"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket||"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket||"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket;t.hasBuiltInWebSocket=y;const b=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage||"undefined"!==typeof window&&"undefined"!==typeof window.localStorage;t.hasLocalStorage=b;const R=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage?n.g.localStorage:"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?window.localStorage:localStorage;t.resolveLocalStorage=R;const S=()=>"undefined"!==typeof window;function D(e,t=f){(0,u.logDebug)(`hash key called ${e}`);const n=(0,a.hash)((0,s.fromString)(e,t));return(0,c.toString)(n,t)}function I(){return r.default.randomBytes(t.RANDOM_LENGTH)}function P(){let e=I();return(0,u.logDebug)(`generate topic called ${e}`),D((0,c.toString)(e,f))}function m(e){return(0,d.generateOKXLink)(e)}t.isBrowser=S,t.RANDOM_LENGTH=32},6556:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryGetLocalStorage=r;const o=n(6274);function r(){return"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?window.localStorage:"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage?n.g.localStorage:o.InMemoryStorage.getInstance()}},409:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.CHAIN=t.OKX_TON_TRANSACTION_SIGNING_FAILED=t.OKX_TON_TRANSACTION_SIGNED=t.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE=t.OKX_TON_DISCONNECTION=t.OKX_TON_CONNECTION_STARTED=t.OKX_TON_CONNECTION_RESTORING_STARTED=t.OKX_TON_CONNECTION_RESTORING_ERROR=t.OKX_TON_CONNECTION_RESTORING_COMPLETED=t.OKX_TON_CONNECTION_ERROR=t.OKX_TON_CONNECTION_COMPLETED=t.WalletNotConnectedError=t.WalletNotSupportFeatureError=t.WalletAlreadyConnectedError=t.UserRejectsError=t.UnknownError=t.OkxConnectError=t.OKXTonConnect=t.utils=t.ConnectionManager=t.SessionCrypto=t.OKXWalletConnector=void 0;var s=n(3750);Object.defineProperty(t,"OKXWalletConnector",{enumerable:!0,get:function(){return s.OKXWalletConnector}});var c=n(3318);Object.defineProperty(t,"SessionCrypto",{enumerable:!0,get:function(){return c.SessionCrypto}});var a=n(4555);Object.defineProperty(t,"ConnectionManager",{enumerable:!0,get:function(){return a.ConnectionManager}}),t.utils=i(n(1930));var l=n(5193);Object.defineProperty(t,"OKXTonConnect",{enumerable:!0,get:function(){return l.OKXTonConnect}});var d=n(1082);Object.defineProperty(t,"OkxConnectError",{enumerable:!0,get:function(){return d.OkxConnectError}}),Object.defineProperty(t,"UnknownError",{enumerable:!0,get:function(){return d.UnknownError}}),Object.defineProperty(t,"UserRejectsError",{enumerable:!0,get:function(){return d.UserRejectsError}}),Object.defineProperty(t,"WalletAlreadyConnectedError",{enumerable:!0,get:function(){return d.WalletAlreadyConnectedError}}),Object.defineProperty(t,"WalletNotSupportFeatureError",{enumerable:!0,get:function(){return d.WalletNotSupportFeatureError}}),Object.defineProperty(t,"WalletNotConnectedError",{enumerable:!0,get:function(){return d.WalletNotConnectedError}});var u=n(3123);Object.defineProperty(t,"OKX_TON_CONNECTION_COMPLETED",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_COMPLETED}}),Object.defineProperty(t,"OKX_TON_CONNECTION_ERROR",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_ERROR}}),Object.defineProperty(t,"OKX_TON_CONNECTION_RESTORING_COMPLETED",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_RESTORING_COMPLETED}}),Object.defineProperty(t,"OKX_TON_CONNECTION_RESTORING_ERROR",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_RESTORING_ERROR}}),Object.defineProperty(t,"OKX_TON_CONNECTION_RESTORING_STARTED",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_RESTORING_STARTED}}),Object.defineProperty(t,"OKX_TON_CONNECTION_STARTED",{enumerable:!0,get:function(){return u.OKX_TON_CONNECTION_STARTED}}),Object.defineProperty(t,"OKX_TON_DISCONNECTION",{enumerable:!0,get:function(){return u.OKX_TON_DISCONNECTION}}),Object.defineProperty(t,"OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE",{enumerable:!0,get:function(){return u.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE}}),Object.defineProperty(t,"OKX_TON_TRANSACTION_SIGNED",{enumerable:!0,get:function(){return u.OKX_TON_TRANSACTION_SIGNED}}),Object.defineProperty(t,"OKX_TON_TRANSACTION_SIGNING_FAILED",{enumerable:!0,get:function(){return u.OKX_TON_TRANSACTION_SIGNING_FAILED}});var f=n(3123);Object.defineProperty(t,"CHAIN",{enumerable:!0,get:function(){return f.CHAIN}})},9069:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardDeeplink=t.standardUniversalLink=t.tonConnectSdkVersion=void 0,t.tonConnectSdkVersion="1",t.standardUniversalLink="https://www.okx.com/download",t.standardDeeplink="okx://web3/wallet/connect"},3123:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(5193);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.OKXTonConnect}}),r(n(9278),t),r(n(2684),t)},3105:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5420:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(4346),t),r(n(3105),t)},4346:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9278:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(8342),t),r(n(619),t),r(n(5420),t),r(n(4396),t)},5026:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},619:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(5026),t),r(n(8523),t)},8523:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4396:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(1333),t),r(n(1300),t)},618:function(e,t){"use strict";var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=t.CONNECT_EVENT_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["MANIFEST_NOT_FOUND_ERROR"]=2]="MANIFEST_NOT_FOUND_ERROR",e[e["MANIFEST_CONTENT_ERROR"]=3]="MANIFEST_CONTENT_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=300]="USER_REJECTS_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.CONNECT_EVENT_ERROR_CODES=n={})),function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(o||(t.CONNECT_ITEM_ERROR_CODES=o={}))},1333:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=t.CONNECT_EVENT_ERROR_CODES=void 0;var o=n(618);Object.defineProperty(t,"CONNECT_EVENT_ERROR_CODES",{enumerable:!0,get:function(){return o.CONNECT_EVENT_ERROR_CODES}}),Object.defineProperty(t,"CONNECT_ITEM_ERROR_CODES",{enumerable:!0,get:function(){return o.CONNECT_ITEM_ERROR_CODES}})},5732:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DISCONNECT_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.DISCONNECT_ERROR_CODES=n={}))},1300:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DISCONNECT_ERROR_CODES=t.SIGN_DATA_ERROR_CODES=t.SEND_TRANSACTION_ERROR_CODES=void 0;var o=n(2307);Object.defineProperty(t,"SEND_TRANSACTION_ERROR_CODES",{enumerable:!0,get:function(){return o.SEND_TRANSACTION_ERROR_CODES}});var r=n(8204);Object.defineProperty(t,"SIGN_DATA_ERROR_CODES",{enumerable:!0,get:function(){return r.SIGN_DATA_ERROR_CODES}});var i=n(5732);Object.defineProperty(t,"DISCONNECT_ERROR_CODES",{enumerable:!0,get:function(){return i.DISCONNECT_ERROR_CODES}})},2307:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SEND_TRANSACTION_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=3]="USER_REJECTS_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.SEND_TRANSACTION_ERROR_CODES=n={}))},8204:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SIGN_DATA_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=3]="USER_REJECTS_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.SIGN_DATA_ERROR_CODES=n={}))},3835:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CHAIN=void 0,function(e){e["MAINNET"]="-239",e["TESTNET"]="-3"}(n||(t.CHAIN=n={}))},8342:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHAIN=void 0;var o=n(3835);Object.defineProperty(t,"CHAIN",{enumerable:!0,get:function(){return o.CHAIN}})},5410:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connectErrorsParser=void 0;const o=n(1082),r=n(9278),i={[r.CONNECT_EVENT_ERROR_CODES.UNKNOWN_ERROR]:o.UnknownError,[r.CONNECT_EVENT_ERROR_CODES.USER_REJECTS_ERROR]:o.UserRejectsError};class s{parseError(e){let t=o.UnknownError;return e.code in i&&(t=i[e.code]||o.UnknownError),new t(e.message)}}t.connectErrorsParser=new s},5175:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RpcParser=void 0;class n{isError(e){return"error"in e}}t.RpcParser=n},3985:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendTransactionParser=void 0;const o=n(9278),r=n(5175),i=n(1082),s={[o.SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR]:i.UnknownError,[o.SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR]:i.UserRejectsError};class c extends r.RpcParser{convertToRpcRequest(e){return{method:"ton_sendTransaction",params:e}}parseAndThrowError(e){let t=i.UnknownError;throw e.error.code in s&&(t=s[e.error.code]||i.UnknownError),new t(e.error.message)}convertFromRpcResponse(e){return{boc:e.result.toString()}}}t.sendTransactionParser=new c},161:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeConnectionStorage=void 0;const r=n(1394),i=n(4529);class s{constructor(e){this.storage=e,this.storeKey="okx-ton-connect-storage_bridge-connection"}storeConnection(e){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> storeConnection ==>> connection:",e),this.storage.setItem(this.storeKey,JSON.stringify(e))}))}removeConnection(){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> removeConnection"),this.storage.removeItem(this.storeKey)}))}getConnection(){return o(this,void 0,void 0,(function*(){const e=yield this.storage.getItem(this.storeKey);if((0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>stored: ",e),(0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>this.storage: ",this.storage),!e)return null;let t;return t=JSON.parse(e),t}))}getHttpConnection(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(!e)throw new r.OkxConnectError("Trying to read HTTP connection source while nothing is stored");return e}))}storeLastWalletEventId(e){return o(this,void 0,void 0,(function*(){const t=yield this.getConnection();if(t&&"connectEvent"in t)return t.lastWalletEventId=e,this.storeConnection(t)}))}getLastWalletEventId(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId}))}}t.BridgeConnectionStorage=s},8086:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeProvider=void 0;const r=n(9318),i=n(161),s=n(1110),c=n(4529),a=n(4555),l=n(9069),d=n(7620),u=n(8538),f=n(1082);class h{constructor(e){this.storage=e,this.type="http",this.listeners=[],this.connectManager=new a.ConnectionManager,this.walletConnectionSource={universalLink:l.standardUniversalLink},this.engine=new d.Engine(this.connectManager),this.openUniversalUrl=!1,this.connectionStorage=new i.BridgeConnectionStorage(e)}static fromStorage(e){return o(this,void 0,void 0,(function*(){(0,c.logDebug)("bridge-provider ==>> fromStorage ==>>storage:",e);const t=new i.BridgeConnectionStorage(e),n=yield t.getHttpConnection();if((0,r.isPendingConnectionHttp)(n))return null;const o=new h(e);return o.openUniversalUrl=n.openUniversalUrl,o}))}connect(e,t,n){return o(this,void 0,void 0,(function*(){(0,c.logDebug)("bridge-provider ==>> connect_1 ==>>message:",e),(0,c.logDebug)("bridge-provider ==>> connect_1 ==>>redirect:",t),(0,c.logDebug)("bridge-provider ==>> connect_1 ==>>openUniversalUrl:",n);try{const r=this.connectManager.getConnectInfo(),i=yield this.engine.getRequestId();this.openUniversalUrl=n;const a={protocolVer:Number(l.tonConnectSdkVersion),topic:r.channelId,clientId:r.clientId,requestId:i,dAppInfo:e.dappInfo,requests:e.items,redirect:null!==t&&void 0!==t?t:"none"},d=JSON.stringify(a),f=u.Buffer.from(d).toString("base64"),h=`${l.standardDeeplink}?param=${f}`;return(0,c.logDebug)("bridge-provider ==>> connect_2 ==>>fullUrl:",h),this.connectionStorage.storeConnection({type:"http",connectionSource:this.walletConnectionSource,channelId:r.channelId,openUniversalUrl:n}).then((()=>o(this,void 0,void 0,(function*(){var e,t;null!==n&&!0===n&&(0,s.openOKXDeeplinkWithFallback)(h),null===(e=this.engine)||void 0===e||e.bindRequestForPromise(i,this.connectListener.bind(this)),null===(t=this.engine)||void 0===t||t.addDisconnectListener(this.disconnectListener.bind(this)),yield this.connectManager.connect()})))),(0,s.getUniversalLink)(h)}catch(r){throw console.error("Error connecting:",r),new f.OkxConnectError("connect error")}}))}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter((t=>t!==e))}disconnectListener(){return o(this,void 0,void 0,(function*(){(0,c.logDebug)("bridge-provider ==>> disconnectListener");const e={event:"disconnect",requestId:Number(1),payload:{}};this.listeners.forEach((t=>t(e))),yield this.closeConnection()}))}connectListener(e){return o(this,void 0,void 0,(function*(){const t=e;if((0,c.logDebug)("bridge-provider ==>> connectListener_1 ==>>walletMessage:",t),void 0!==t.requestId){const e=yield this.connectionStorage.getLastWalletEventId();if(void 0!==e&&Number(t.requestId)<=e)return void(0,c.logError)(`Received event id (=${t.requestId}) must be greater than stored last wallet event id (=${e}) `)}const n=this.listeners;if("connect"===t.method){const e=t.payload.responses.find((e=>"ton_addr"===e.name)),o=t.payload.responses.find((e=>"ton_proof"===e.name)),r=t.payload.wallet,i={platform:r.platform,appName:r.appName,appVersion:r.appVersion,maxProtocolVersion:r.maxProtocolVersion,features:r.features.ton},s=[];e&&s.push(e),o&&s.push(o);const a=yield this.connectionStorage.getConnection(),l={type:"http",lastWalletEventId:Number(t.requestId),connectEvent:{event:"connect",payload:{items:s,device:i}},connectionSource:this.walletConnectionSource,channelId:null===a||void 0===a?void 0:a.channelId,openUniversalUrl:null===a||void 0===a?void 0:a.openUniversalUrl};(0,c.logDebug)("bridge-provider ==>> connectListener_2 ==>>storeConnection:",l),yield this.connectionStorage.storeConnection(l);const d={event:"connect",requestId:Number(t.requestId),payload:l.connectEvent.payload};(0,c.logDebug)("bridge-provider ==>> connectListener_3 ==>>listeners.forEach:",d),n.forEach((e=>e(d)))}else if("connect_error"===t.method){yield this.connectionStorage.storeLastWalletEventId(Number(t.requestId));const e={event:"connect_error",requestId:Number(t.requestId),payload:t.payload};(0,c.logDebug)("bridge-provider ==>> connectListener_4 ==>>connect_error:",e),n.forEach((t=>t(e)))}}))}closeConnection(e){return o(this,void 0,void 0,(function*(){var t,n;(0,c.logDebug)("bridge-provider ==>> closeConnection ==>>fromRestore:",e),this.listeners=[],!0!==e&&(null===(t=this.engine)||void 0===t||t.disconnect(),yield null===(n=this.connectManager)||void 0===n?void 0:n.disconnect(e),yield this.connectionStorage.removeConnection())}))}restoreConnection(){return o(this,void 0,void 0,(function*(){var e;(0,c.logDebug)("bridge-provider ==>> restoreConnection_1");const t=yield this.connectionStorage.getHttpConnection();if(t&&!(0,r.isPendingConnectionHttp)(t))if((0,c.logDebug)("bridge-provider ==>> restoreConnection_2 ==>>storedConnection.channelId:",t.channelId),t.channelId)try{const n={event:"connect",requestId:Number(0),payload:t.connectEvent.payload};this.listeners.forEach((e=>e(n)));const o=t.channelId;(0,c.logDebug)("bridge-provider ==>> restoreConnection_3 ==>>this.connectManager.restoreConnect:",o),null===(e=this.engine)||void 0===e||e.addDisconnectListener(this.disconnectListener.bind(this)),yield this.connectManager.restoreConnect(o)}catch(n){(0,c.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_1"),yield this.closeConnection()}else(0,c.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_2"),yield this.closeConnection()}))}openOKXWallet(){if(this.openUniversalUrl){const e=`${l.standardUniversalLink}?deeplink=${encodeURIComponent(l.standardDeeplink)}`;(0,s.openOKXDeeplinkWithFallback)(e)}}disconnect(){return o(this,void 0,void 0,(function*(){return(0,c.logDebug)("bridge-provider ==>> disconnect_1"),new Promise((e=>o(this,void 0,void 0,(function*(){let t=!1;const n=()=>{t||(t=!0,setTimeout((()=>{this.closeConnection().then(e)}),1e3))};try{yield this.sendRequest({method:"disconnect"},{onRequestSent:n,attempts:1})}catch(o){t||this.closeConnection().then(e)}finally{n()}}))))}))}sendRequest(e,t){return(0,c.logDebug)("bridge-provider ==>> sendRequest"),new Promise(((n,r)=>o(this,void 0,void 0,(function*(){var o,r;yield null===(o=this.engine)||void 0===o?void 0:o.send(e,(function(e){n(e)}),{attempts:null===t||void 0===t?void 0:t.attempts}),null===(r=null===t||void 0===t?void 0:t.onRequestSent)||void 0===r||r.call(t)}))))}}t.BridgeProvider=h},9318:function(e,t){"use strict";function n(e){return!("connectEvent"in e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPendingConnectionHttp=n},5193:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXTonConnect=void 0;const i=n(9278),s=n(8086),c=n(5998),a=n(7677),l=n(6903),d=n(3985),u=n(9069),f=n(161),h=n(5410),_=n(4529),g=n(1082);class O{constructor(e){if(this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[],this.storage=new c.DefaultStorage,!(null===e||void 0===e?void 0:e.metaData))throw new g.OkxConnectError("dapp metaData can not be null");this.dappSettings={metaData:e.metaData},this.tracker=new l.TonConnectTracker({tonConnectSdkVersion:u.tonConnectSdkVersion}),this.bridgeConnectionStorage=new f.BridgeConnectionStorage(this.storage)}get connected(){return null!==this._wallet}get account(){var e;return(null===(e=this._wallet)||void 0===e?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach((e=>e(this._wallet)))}connect(e){return o(this,void 0,void 0,(function*(){var t;if((0,_.logDebug)("ton-Connect ==>> connect_1 >> request:",e),this.connected)throw new g.WalletAlreadyConnectedError;return yield null===(t=this.provider)||void 0===t?void 0:t.closeConnection(),this.provider=new s.BridgeProvider(this.storage),this.provider.listen(this.walletEventsListener.bind(this)),this.tracker.trackConnectionStarted(),this.provider.connect(this.createConnectRequest(e),null===e||void 0===e?void 0:e.redirect,null===e||void 0===e?void 0:e.openUniversalUrl)}))}walletEventsListener(e){switch((0,_.logDebug)("ton-Connect ==>> walletEventsListener_1 >> e:",e),e.event){case"connect":this.onWalletConnected(e.payload);break;case"connect_error":this.onWalletConnectError(e.payload);break;case"disconnect":this.onWalletDisconnected("wallet")}}onWalletConnected(e){(0,_.logDebug)("ton-Connect ==>> onWalletConnected_1 >> connectEvent:",e);const t=e.items.find((e=>"ton_addr"===e.name)),n=e.items.find((e=>"ton_proof"===e.name));if(!t)throw new g.OkxConnectError("ton_addr connection item was not found");const o={device:e.device,provider:this.provider.type,account:{address:t.address,chain:t.network,walletStateInit:t.walletStateInit,publicKey:t.publicKey}};n&&(o.connectItems={tonProof:n}),this.wallet=o,(0,_.logDebug)("ton-Connect ==>> onWalletConnected_2 >> wallet:",o),this.tracker.trackConnectionCompleted(o)}onWalletConnectError(e){var t;const n=h.connectErrorsParser.parseError(e);(0,_.logDebug)("ton-Connect ==>> onWalletConnectError_1 >> error:",n),this.statusChangeErrorSubscriptions.forEach((e=>e(n))),this.tracker.trackConnectionError(null!==(t=e.message)&&void 0!==t?t:"",e.code)}onWalletDisconnected(e){this.tracker.trackDisconnection(this.wallet,e),this.wallet=null}disconnect(){return o(this,void 0,void 0,(function*(){var e;if((0,_.logDebug)("ton-Connect ==>> disconnect_1"),!this.connected)throw new g.OkxConnectError("wallet is not connected");(0,_.logDebug)("ton-Connect ==>> disconnect_222"),this.onWalletDisconnected("dapp"),yield null===(e=this.provider)||void 0===e?void 0:e.disconnect()}))}onStatusChange(e,t){return this.statusChangeSubscriptions.push(e),t&&this.statusChangeErrorSubscriptions.push(t),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter((t=>t!==e)),t&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter((e=>e!==t)))}}restoreConnection(){return o(this,void 0,void 0,(function*(){var e;(0,_.logDebug)("ton-Connect ==>> restoreConnection_1"),this.tracker.trackConnectionRestoringStarted();let t=null;try{t=yield s.BridgeProvider.fromStorage(this.storage)}catch(n){return this.tracker.trackConnectionRestoringError("Provider is not restored"),yield this.bridgeConnectionStorage.removeConnection(),null===t||void 0===t||t.closeConnection(),void(t=null)}if(!t)return(0,_.logError)("Provider is not restored"),void this.tracker.trackConnectionRestoringError("Provider is not restored");(0,_.logDebug)("ton-Connect ==>> restoreConnection_2 ==>> Provider is restored "),null===(e=this.provider)||void 0===e||e.closeConnection(!0),this.provider=t,t.listen(this.walletEventsListener.bind(this)),yield this.provider.restoreConnection(),this.connected?this.tracker.trackConnectionRestoringCompleted(this.wallet):this.tracker.trackConnectionRestoringError("Connection restoring failed")}))}sendTransaction(e,t){return o(this,void 0,void 0,(function*(){(0,_.logDebug)("ton-Connect ==>> sendTransaction_1"),this.checkConnection(),(0,a.checkSendTransactionSupport)(this.wallet.device.features,{requiredMessagesNumber:e.messages.length}),this.tracker.trackTransactionSentForSignature(this.wallet,e),(0,_.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> check params");const{validUntil:n}=e,o=r(e,["validUntil"]),s=e.from||this.account.address,c=e.network||this.account.chain;if(c==i.CHAIN.TESTNET)throw new g.OkxConnectError("just support mainNet");(0,_.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> await sendRequest");const l=yield this.provider.sendRequest(d.sendTransactionParser.convertToRpcRequest(Object.assign(Object.assign({},o),{valid_until:n,from:s,network:c})),{onRequestSent:()=>{var e,n;null===(e=null===t||void 0===t?void 0:t.onRequestSent)||void 0===e||e.call(t),null===(n=this.provider)||void 0===n||n.openOKXWallet()}});if((0,_.logDebug)("ton-Connect ==>> sendTransaction_3 ==>>sendRequest response:",l),d.sendTransactionParser.isError(l))return this.tracker.trackTransactionSigningFailed(this.wallet,e,l.error.message,l.error.code),d.sendTransactionParser.parseAndThrowError(l);const u=d.sendTransactionParser.convertFromRpcResponse(l);return this.tracker.trackTransactionSigned(this.wallet,e,u),u}))}checkConnection(){if((0,_.logDebug)("ton-Connect ==>> checkConnection"),!this.connected)throw new g.WalletNotConnectedError}createConnectRequest(e){(0,_.logDebug)("ton-Connect ==>> createConnectRequest");const t=[{name:"ton_addr"}];return(null===e||void 0===e?void 0:e.tonProof)&&t.push({name:"ton_proof",payload:e.tonProof}),{dappInfo:this.dappSettings.metaData,items:t}}}t.OKXTonConnect=O},7699:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserEventDispatcher=void 0;class o{constructor(){this.window=window}dispatchEvent(e,t){return n(this,void 0,void 0,(function*(){var n;const o=new CustomEvent(e,{detail:t});null===(n=this.window)||void 0===n||n.dispatchEvent(o)}))}addEventListener(e,t,o){return n(this,void 0,void 0,(function*(){var n;return null===(n=this.window)||void 0===n||n.addEventListener(e,t,o),()=>{var n;return null===(n=this.window)||void 0===n?void 0:n.removeEventListener(e,t)}}))}}t.BrowserEventDispatcher=o},6903:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TonConnectTracker=void 0;const r=n(1489),i=n(7699);class s{get version(){return(0,r.createVersionInfo)({ton_connect_sdk_lib:this.tonConnectSdkVersion})}constructor(e){this.eventPrefix="ton-connect-",this.eventDispatcher=new i.BrowserEventDispatcher,this.tonConnectSdkVersion=e.tonConnectSdkVersion,this.init().catch()}init(){return o(this,void 0,void 0,(function*(){try{yield this.setRequestVersionHandler()}catch(e){}}))}setRequestVersionHandler(){return o(this,void 0,void 0,(function*(){yield this.eventDispatcher.addEventListener("ton-connect-request-version",(()=>o(this,void 0,void 0,(function*(){yield this.eventDispatcher.dispatchEvent("ton-connect-response-version",(0,r.createResponseVersionEvent)(this.tonConnectSdkVersion))}))))}))}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch(t){}}trackConnectionStarted(...e){try{const t=(0,r.createConnectionStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionCompleted(...e){try{const t=(0,r.createConnectionCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionError(...e){try{const t=(0,r.createConnectionErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringStarted(...e){try{const t=(0,r.createConnectionRestoringStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringCompleted(...e){try{const t=(0,r.createConnectionRestoringCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringError(...e){try{const t=(0,r.createConnectionRestoringErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackDisconnection(...e){try{const t=(0,r.createDisconnectionEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSentForSignature(...e){try{const t=(0,r.createTransactionSentForSignatureEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigned(...e){try{const t=(0,r.createTransactionSignedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigningFailed(...e){try{const t=(0,r.createTransactionSigningFailedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}}t.TonConnectTracker=s},2684:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_TON_TRANSACTION_SIGNING_FAILED=t.OKX_TON_TRANSACTION_SIGNED=t.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE=t.OKX_TON_DISCONNECTION=t.OKX_TON_CONNECTION_RESTORING_ERROR=t.OKX_TON_CONNECTION_RESTORING_COMPLETED=t.OKX_TON_CONNECTION_RESTORING_STARTED=t.OKX_TON_CONNECTION_ERROR=t.OKX_TON_CONNECTION_COMPLETED=t.OKX_TON_CONNECTION_STARTED=void 0,t.OKX_TON_CONNECTION_STARTED="ton-connect-connection-started",t.OKX_TON_CONNECTION_COMPLETED="ton-connect-connection-completed",t.OKX_TON_CONNECTION_ERROR="ton-connect-connection-error",t.OKX_TON_CONNECTION_RESTORING_STARTED="ton-connect-connection-restoring-started",t.OKX_TON_CONNECTION_RESTORING_COMPLETED="ton-connect-connection-restoring-completed",t.OKX_TON_CONNECTION_RESTORING_ERROR="ton-connect-connection-restoring-error",t.OKX_TON_DISCONNECTION="ton-connect-disconnection",t.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE="ton-connect-transaction-sent-for-signature",t.OKX_TON_TRANSACTION_SIGNED="ton-connect-transaction-signed",t.OKX_TON_TRANSACTION_SIGNING_FAILED="ton-connect-transaction-signing-failed"},1489:function(e,t){"use strict";function n(){return{type:"request-version"}}function o(e){return{type:"response-version",version:e}}function r(e){return{ton_connect_sdk_lib:e.ton_connect_sdk_lib}}function i(e,t){var n,o,i,s,c,a,l,d;const u=(null===(n=null===t||void 0===t?void 0:t.connectItems)||void 0===n?void 0:n.tonProof)&&"proof"in t.connectItems.tonProof,f=u?"ton_proof":"ton_addr";return{wallet_address:null!==(i=null===(o=null===t||void 0===t?void 0:t.account)||void 0===o?void 0:o.address)&&void 0!==i?i:null,wallet_type:null!==(s=null===t||void 0===t?void 0:t.device.appName)&&void 0!==s?s:null,wallet_version:null!==(c=null===t||void 0===t?void 0:t.device.appVersion)&&void 0!==c?c:null,auth_type:f,custom_data:Object.assign({chain_id:null!==(l=null===(a=null===t||void 0===t?void 0:t.account)||void 0===a?void 0:a.chain)&&void 0!==l?l:null,provider:null!==(d=null===t||void 0===t?void 0:t.provider)&&void 0!==d?d:null},r(e))}}function s(e){return{type:"connection-started",custom_data:r(e)}}function c(e,t){return Object.assign({type:"connection-completed",is_success:!0},i(e,t))}function a(e,t,n){return{type:"connection-error",is_success:!1,error_message:t,error_code:null!==n&&void 0!==n?n:null,custom_data:r(e)}}function l(e){return{type:"connection-restoring-started",custom_data:r(e)}}function d(e,t){return Object.assign({type:"connection-restoring-completed",is_success:!0},i(e,t))}function u(e,t){return{type:"connection-restoring-error",is_success:!1,error_message:t,custom_data:r(e)}}function f(e,t){var n,o,r,i;return{valid_until:null!==(n=String(t.validUntil))&&void 0!==n?n:null,from:null!==(i=null!==(o=t.from)&&void 0!==o?o:null===(r=null===e||void 0===e?void 0:e.account)||void 0===r?void 0:r.address)&&void 0!==i?i:null,messages:t.messages.map((e=>{var t,n;return{address:null!==(t=e.address)&&void 0!==t?t:null,amount:null!==(n=e.amount)&&void 0!==n?n:null}}))}}function h(e,t,n){return Object.assign(Object.assign({type:"transaction-sent-for-signature"},i(e,t)),f(t,n))}function _(e,t,n,o){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:o.boc},i(e,t)),f(t,n))}function g(e,t,n,o,r){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:o,error_code:null!==r&&void 0!==r?r:null},i(e,t)),f(t,n))}function O(e,t,n){return Object.assign({type:"disconnection",scope:n},i(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestVersionEvent=n,t.createResponseVersionEvent=o,t.createVersionInfo=r,t.createConnectionStartedEvent=s,t.createConnectionCompletedEvent=c,t.createConnectionErrorEvent=a,t.createConnectionRestoringStartedEvent=l,t.createConnectionRestoringCompletedEvent=d,t.createConnectionRestoringErrorEvent=u,t.createTransactionSentForSignatureEvent=h,t.createTransactionSignedEvent=_,t.createTransactionSigningFailedEvent=g,t.createDisconnectionEvent=O},7677:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkSendTransactionSupport=i;const o=n(9171),r=n(4529);function i(e,t){const n=e.includes("ton_sendTransaction"),i=e.find((e=>e&&"object"===typeof e&&"ton_sendTransaction"===e.name));if(!n&&!i)throw new o.WalletNotSupportFeatureError("Wallet doesn't support SendTransaction feature.");if(i&&void 0!==i.maxMessages){if(i.maxMessages<t.requiredMessagesNumber)throw new o.WalletNotSupportFeatureError(`Wallet is not able to handle such SendTransaction request. Max support messages number is ${i.maxMessages}, but ${t.requiredMessagesNumber} is required.`)}else(0,r.logWarning)("Connected wallet didn't provide information about max allowed messages in the SendTransaction request. Request may be rejected by the wallet.")}},2739:function(e,t,n){"use strict";var o=n(5130),r=n(9543),i=(n(4188),n(6768)),s=n(4232);const c=e=>((0,i.Qi)("data-v-afbf989c"),e=e(),(0,i.jt)(),e),a={id:"app"},l=c((()=>(0,i.Lk)("div",null,"钱包信息",-1))),d=c((()=>(0,i.Lk)("strong",null,"Wallet Address:",-1))),u=c((()=>(0,i.Lk)("strong",null,"当前状态 :",-1))),f=c((()=>(0,i.Lk)("div",null,"钱包操作",-1))),h=c((()=>(0,i.Lk)("strong",null,"verify",-1))),_=c((()=>(0,i.Lk)("h2",null,"扫描二维码",-1))),g=c((()=>(0,i.Lk)("div",null,"交易",-1))),O=c((()=>(0,i.Lk)("div",{class:"input-label"},"交易数据（可选，有默认） :",-1))),E=c((()=>(0,i.Lk)("div",{class:"input-label"},"签名结果 :",-1)));function v(e,t,n,r,c,v){const p=(0,i.g2)("el-header"),C=(0,i.g2)("el-col"),N=(0,i.g2)("el-row"),T=(0,i.g2)("el-card"),y=(0,i.g2)("el-input"),b=(0,i.g2)("el-checkbox"),R=(0,i.g2)("el-button"),S=(0,i.g2)("qrcode-vue"),D=(0,i.g2)("el-main"),I=(0,i.g2)("el-container");return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.bF)(I,null,{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.eW)("OKX Connect")])),_:1}),(0,i.bF)(D,null,{default:(0,i.k6)((()=>[(0,i.bF)(T,{class:"wallet-info"},{header:(0,i.k6)((()=>[l])),default:(0,i.k6)((()=>[(0,i.bF)(N,{class:"info-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[d,(0,i.eW)(" "+(0,s.v_)(v.getWalletAddress),1)])),_:1})])),_:1}),(0,i.bF)(N,{class:"info-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[u,(0,i.eW)(" "+(0,s.v_)(e.currentStatus),1)])),_:1})])),_:1})])),_:1}),(0,i.bF)(T,{class:"wallet-actions"},{header:(0,i.k6)((()=>[f])),default:(0,i.k6)((()=>[(0,i.bF)(N,{gutter:12},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[(0,i.bF)(y,{modelValue:e.testProofPayload,"onUpdate:modelValue":t[0]||(t[0]=t=>e.testProofPayload=t),placeholder:"proofPayload"},null,8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(N,{class:"info-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:16},{default:(0,i.k6)((()=>[(0,i.bF)(b,{modelValue:e.isChecked,"onUpdate:modelValue":t[1]||(t[1]=t=>e.isChecked=t),onChange:e.handleChange},{default:(0,i.k6)((()=>[(0,i.eW)(" 是否自动 restoreConnection")])),_:1},8,["modelValue","onChange"])])),_:1}),(0,i.bF)(C,{span:8,style:{display:"flex","align-items":"center"}},{default:(0,i.k6)((()=>[h,(0,i.eW)(" "+(0,s.v_)(e.ProofPayloadVerify),1)])),_:1})])),_:1}),(0,i.bF)(N,{gutter:12,class:"button-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[(0,i.bF)(R,{type:"primary",onClick:v.connectBtnClicked,icon:"el-icon-connection"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.connectStatusStr),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),((0,i.uX)(),(0,i.Wv)(i.Im,{to:"body"},[e.showModal?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=(...e)=>v.closeModal&&v.closeModal(...e))},[(0,i.Lk)("div",{class:"modal-content",onClick:t[3]||(t[3]=(0,o.D$)((()=>{}),["stop"]))},[(0,i.Lk)("button",{class:"close-button",onClick:t[2]||(t[2]=(...e)=>v.closeModal&&v.closeModal(...e))},"×"),_,(0,i.bF)(S,{value:e.qrValue,size:200,level:"H"},null,8,["value"])])])):(0,i.Q3)("",!0)])),(0,i.bF)(N,{gutter:12,class:"button-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[(0,i.bF)(R,{type:"warning",onClick:v.resotreConnectAction,icon:"el-icon-refresh-right"},{default:(0,i.k6)((()=>[(0,i.eW)("尝试重连")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,i.bF)(N,{gutter:12,class:"button-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[(0,i.bF)(R,{type:"danger",onClick:v.disconnectAction,icon:"el-icon-switch-button",disabled:0==e.walletAddress.length},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.disconnectStatusStr),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),(0,i.bF)(T,{class:"transaction"},{header:(0,i.k6)((()=>[g])),default:(0,i.k6)((()=>[(0,i.bF)(C,{xs:24,sm:12},{default:(0,i.k6)((()=>[O,(0,i.bF)(y,{modelValue:e.testTransaction,"onUpdate:modelValue":t[5]||(t[5]=t=>e.testTransaction=t),placeholder:"sendTransactions"},null,8,["modelValue"])])),_:1}),(0,i.bF)(C,{xs:24,sm:12},{default:(0,i.k6)((()=>[E,(0,i.bF)(y,{modelValue:e.testboc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.testboc=t),placeholder:"boc"},null,8,["modelValue"])])),_:1}),(0,i.bF)(N,{gutter:12,class:"button-row"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{span:24},{default:(0,i.k6)((()=>[(0,i.bF)(R,{type:"primary",onClick:t[7]||(t[7]=e=>v.sendTransaction())},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.testTransactionStr),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])}var p=n(409),C=n(9877),N=n(1557),T=new p.OKXTonConnect({metaData:{name:"测试dapp",icon:"",url:"okx.com"}});window.ton=T;var y={name:"App",components:{QrcodeVue:C.A},data:()=>({testTopic:"",testPublicKey:"",testProofPayload:"",pendingDeepLink:"-",logList:[],connectReady:!1,connectStatusStr:"连接钱包",disconnectStatusStr:"断开钱包",localPubKey:"",localSecKey:"",testTransaction:"",testTransactionStr:"发送交易",walletAddress:"",testboc:"",ProofPayloadVerify:"",showModal:!1,qrValue:"https://www.okx.com/download",currentStatus:"",isChecked:"true"==localStorage.getItem("autoRefresh"),handleChange:e=>{localStorage.setItem("autoRefresh",`${e}`)}}),computed:{updateUniLink:function(){console.log(`update uni link: ${this.testTopic} ${this.testPublicKey}`);let e=p.utils.generateDeepLink({protocolVer:"1",channelId:this.testTopic,clientId:this.testPublicKey,dAppInfo:{name:"test",url:"-",iconUrl:"-"},requestId:"0",testPayload:this.testProofPayload});return e},getWalletAddress:function(){return this.walletAddress}},methods:{async connectBtnClicked(){this.testTonSdk()},async disconnectAction(){try{console.log("get disconnect wallet btn clicked"),await T.disconnect()}catch(e){console.log("Disconnect  error ==>> ",e.message),this.currentStatus=e.message}},async resotreConnectAction(){console.log("get restore wallet btn clicked"),T.restoreConnection()},async sendTransaction(){if(console.log("sendTransaction"),console.log("sendTransaction内容------",this.testTransaction),this.testTransaction){const e=JSON.parse(this.testTransaction);return console.log("sendTransaction--结束-----",e),void T.sendTransaction(e)}let e={messages:[{address:"EQARULUYsmJq1RiZ-YiH-IJLcAZUVkVff-KBPwEmmaQGH6aC",amount:"205000000",payload:"te6cckEBAgEAhwABbQ+KfqUAAADNgG7tIEATEtAIAO87mQKicbKgHIk4pSPP4k5xhHqutqYgAB7USnesDnCcECwbgQMBAJUlk4VhgBD3JEg1TUr75iTijBghOKm/sxNDXUBl7CD6WMut0Q85x4RafwA/Es89DBXoTxuqxVFxyBbzt9Rav2HBUKl7hmkvLuKHLBCW57aK"}],validUntil:1792481054071,network:-239,from:"UQD8Szz0MFehPG6rFUXHIFvO31Fq_YcFQqXuGaS8u4ocsJdI"};try{var t=await T.sendTransaction(e);this.testboc=t.boc}catch(n){n instanceof p.UserRejectsError?this.testboc="用户拒绝交易":this.testboc="签名错误！"}},async testTonSdk(){if(T.connected)console.log("you have connected wallet");else{console.log("APP ---connect Proof---\x3e>>>----",this.testProofPayload);let e={tonProof:this.testProofPayload,redirect:"tg://resolve",openUniversalUrl:!0};if(this.isPC()){e.redirect=null,e.openUniversalUrl=!1,console.log("Is PC, showing connectData",e);let t=await T.connect(e);console.log("Is PC, showing modal ==>",t),t&&(this.qrValue=t,this.showModal=!0)}else this.isSafariOrChrome()&&(e.redirect=null),console.log("Is Mobile ==>",e),await T.connect(e)}},closeModal(){this.showModal=!1},isPC(){const e=navigator.userAgent;console.log("current device ua is ===>",e);const t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let n=!0;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!1;break}return n},isSafariOrChrome(){const e=navigator.userAgent,t=["Safari","Chrome"];let n=!1;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!0;break}return n}},created(){const e=[p.OKX_TON_CONNECTION_STARTED,p.OKX_TON_CONNECTION_COMPLETED,p.OKX_TON_CONNECTION_ERROR,p.OKX_TON_CONNECTION_RESTORING_STARTED,p.OKX_TON_CONNECTION_RESTORING_COMPLETED,p.OKX_TON_CONNECTION_RESTORING_ERROR,p.OKX_TON_DISCONNECTION,p.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE,p.OKX_TON_TRANSACTION_SIGNED,p.OKX_TON_TRANSACTION_SIGNING_FAILED];e.forEach((e=>{window.addEventListener(e,(t=>{console.log(e,t.detail),this.currentStatus=e}))}))},mounted(){this.connectReady=!0,T.onStatusChange((e=>{if(console.log("APP ---TON.onStatusChange>>----",e),e){if(this.walletAddress=e.account.address,this.testProofPayload){var t={address:this.walletAddress,network:e.account.chain,public_key:e.account.publicKey,proof:{...e.connectItems.tonProof.proof,state_init:e.account.walletStateInit}};console.log(`checkProof => ${JSON.stringify(t)}`),(new N.TonProofService).checkProof(t).then((e=>{this.ProofPayloadVerify=`${e}`})).catch((e=>{this.ProofPayloadVerify=`error ${e}`}))}else this.ProofPayloadVerify=": no proof";this.showModal=!1}else this.walletAddress="disconnected"}),(e=>{this.showModal=!1,e instanceof p.UserRejectsError?this.walletAddress="用户拒绝链接":this.walletAddress=`链接报错 ！ ${e.message}`})),this.isChecked&&T.restoreConnection()}},b=n(1241);const R=(0,b.A)(y,[["render",v],["__scopeId","data-v-afbf989c"]]);var S=R;const D=(0,o.Ef)(S);D.use(r.A),D.mount("#app")},1557:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(t){i(t)}}function c(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?n(e.value):r(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TonProofService=void 0;const r=n(712),i=n(7470),s=n(7962),c=n(6788),a="ton-proof-item-v2/",l="ton-connect";class d{checkProof(e){return o(this,void 0,void 0,(function*(){try{console.log("checkProof  ===> start  ");const t=(0,s.loadStateInit)(s.Cell.fromBase64(e.proof.state_init).beginParse()),n=r.Buffer.from(e.public_key,"hex"),o=s.Address.parse(e.address),d=(0,s.contractAddress)(o.workChain,t);if(!d.equals(o))return!1;const u={workchain:d.workChain,address:d.hash,domain:{lengthBytes:e.proof.domain.lengthBytes,value:e.proof.domain.value},signature:r.Buffer.from(e.proof.signature,"base64"),payload:e.proof.payload,stateInit:e.proof.state_init,timestamp:e.proof.timestamp},f=r.Buffer.alloc(4);f.writeUInt32BE(u.workchain,0);const h=r.Buffer.alloc(8),_=4294967295&u.timestamp,g=Math.floor(u.timestamp/4294967296);h.writeUInt32LE(_,0),h.writeUInt32LE(g,4);const O=r.Buffer.alloc(4);O.writeUInt32LE(u.domain.lengthBytes,0);const E=r.Buffer.concat([r.Buffer.from(a),f,u.address,O,r.Buffer.from(u.domain.value),h,r.Buffer.from(u.payload)]),v=r.Buffer.from(yield(0,c.sha256)(E)),p=r.Buffer.concat([r.Buffer.from([255,255]),r.Buffer.from(l),v]),C=r.Buffer.from(yield(0,c.sha256)(p));return console.log(`checkProof result  ${JSON.stringify(u)}`),i.sign.detached.verify(C,u.signature,n)}catch(t){return console.log(`checkProof error  ${t}`),!1}}))}}t.TonProofService=d},5444:function(){},9575:function(){},8581:function(){},1281:function(){}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,i){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],i=e[d][2];for(var c=!0,a=0;a<o.length;a++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](o[a])}))?o.splice(a--,1):(c=!1,i<s&&(s=i));if(c){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,r,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,i,s=o[0],c=o[1],a=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(a)var d=a(n)}for(t&&t(o);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},o=self["webpackChunkokxconnect"]=self["webpackChunkokxconnect"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(2739)}));o=n.O(o)})();
//# sourceMappingURL=app.4b347dab.js.map